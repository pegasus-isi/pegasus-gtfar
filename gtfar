#!/bin/bash

### HARD CODED PATHS ###
source /export/uec-gs1/knowles/analysis/tade/gtfar_source/optparse
source /export/uec-gs1/knowles/analysis/tade/gtfar_source/gtfar_setup.sh
export PATH=$PATH:/export/uec-gs1/knowles/analysis/tade/gtfar_source




add_arg program 'annotation/filter-reads/map' 
add_option annotation -a 'gc18' 'annotation - currently supported gc17'  
add_option MULTI reads -r 'reads.fq/fastq'   'read folder or file in fq format'
add_option length -l 100   'length of reads'
add_option cliplength -c 25   'length of anchor for gapped alignment'
add_option strandRule -s 'None'   'A rule for stranded ness (None, Same or Opposite' 
add_option output -o 'outputDir'   'output directory'
add_option working -w 'workingDir'   'working directory'
add_option mismatches -m 3           'The number of mismatches to allow per mapping'
#add_flag showcommands -h 1 'Print all executed commands to standard out' 
#add_flag verbose -v 0 'Verbosity' 

parseargs $@

#--------------------------------------------------------------------------------------------------------------------------------------#



if [ -z $PROGRAM ]; then
    echo "An option is required - choose help"
elif [ $PROGRAM == 'MAP' ] || [ $PROGRAM == 'map' ]; then 
    make_directories  
    load_annotation
    load_reads
    load_parameters
    cd $WORKING
    check_procs $READLIST   
    start_up_output  
    map_and_parse $EXONS "EXONS" YES
    map_and_parse $INTRONS "INTRONS" YES
    novel_splice_search $GENES "SPLICE" YES
    genomic_map $GENOME "GENOME" YES
    combine_output $GENOME YES
    make_bam_files 
    cd ..
    cp -R $WORKING/final_reads $OUTPUT/
    cp -R $WORKING/results $OUTPUT/
fi 

