#!/bin/bash

### HARD CODED PATHS ###
source /export/uec-gs1/knowles/analysis/tade/gtfar_source/optparse
export PATH=$PATH:/export/uec-gs1/knowles/analysis/tade/gtfar_source




add_arg program 'annotation/filter-reads/map' 
add_option annotation -a 'gc18' 'annotation - currently supported gc17'  
add_option MULTI reads -r 'reads.fq/fastq'   'read folder or file in fq format'
add_option length -l 100   'length of reads'
add_option cliplength -c 25   'length of anchor for gapped alignment'
add_option strandRule -s 'None'   'A rule for stranded ness (None, Same or Opposite' 
add_option output -o 'outputDir'   'output directory'
add_option working -w 'workingDir'   'working directory'
add_option mismatches -m 3           'The number of mismatches to allow per mapping'

parseargs $@

#--------------------------------------------------------------------------------------------------------------------------------------#



if [ -z $PROGRAM ]; then
    echo "An option is required - choose help"
elif [ $PROGRAM == 'MAP' ] || [ $PROGRAM == 'map' ]; then 
    source /export/uec-gs1/knowles/analysis/tade/gtfar_source/gtfar_setup.sh
    MYHOME=$PWD
    make_directories  
    load_annotation
    load_reads
    load_parameters
    cd $WORKING
    check_procs $READLIST   
    start_up_output  
    perm_map $EXONS   "EXONS"       ;         feature_parse $EXONS   "EXONS"   
    perm_map $INTRONS "INTRONS"     ;         feature_parse $INTRONS "INTRONS" 
   
    splice_find_and_conditional_map $GENES "SPLICE" 
    
    perm_genome_map $GENOME "GENOME"; genome_parse $GENOME "GENOME" 
    
    combine_output $GENOME $INIT_READS 
    make_bam_files 
    cd $MYHOME
    cp -R $WORKING/final_reads $OUTPUT/
    cp -R $WORKING/results $OUTPUT/

elif [ $PROGRAM == 'READS' ] || [ $PROGRAM == 'reads' ]; then
    source /export/uec-gs1/knowles/analysis/tade/gtfar_source/gtfar_analysis_source.sh
    check_dir $OUTPUT
    make_read_lists
    



fi



